
----------------- CREATING THE DATABASE -------------------
CREATE DATABASE NYC_HOSPITAL_PERFORMANCE_DB

------------------- CREATING TABLES -----------------------

CREATE TABLE DRG_INFORMATION
( 
	DRG                  varchar(10)  NOT NULL ,
	DIAGNOSIS_RELATED_GROUP_DESCRIPTION varchar(2000)  NULL ,
	MAJOR_DIAGNOSTIC_CATEGORY varchar(2000)  NULL ,
	MAJOR_DIAGNOSTIC_CATEGORY_DESCRIPTION varchar(2000)  NULL 
);

-- ADDING PRIMARY KEY CONSTRAINT TO DRG_INFORMATION 

ALTER TABLE DRG_INFORMATION
	ADD CONSTRAINT PK_DRG_INFORMATION_DRG PRIMARY KEY (DRG);



CREATE TABLE EPISODE_OF_CARE
( 
	HOSPITAL_EPISODES_OF_CARE_BY_DRG_FACT_KEY varchar(20)  NOT NULL ,
	HOSPITAL_DIM_KEY     varchar(20)  NOT NULL ,
	YEAR_KEY             datetime  NULL ,
	DRG                  varchar(10)  NULL ,
	COUNT_OF_EPISODE     varchar(200)  NULL ,
	AVERAGE_AMOUNT_PAID_BY_MEDICARE_FOR_HOME_HEALTH varchar(20)  NULL ,
	AVERAGE_AMOUNT_PAID_BY_MEDICARE_FOR_HOSPICE varchar(20)  NULL ,
	AVERAGE_AMOUNT_PAID_BY_MEDICARE_FOR_HOSPITAL integer  NULL ,
	AVERAGE_AMOUNT_CHARGED_BY_FACILITY_FOR_REHAB varchar(20)  NULL ,
	AVERAGE_AMOUNT_PAID_BY_MEDICARE_FOR_SNF varchar(20)  NULL ,
	AVERAGE_AMOUNT_PAID_BY_MEDICARE_FOR_SUBSEQUENT_HOSPITALIZATION varchar(20)  NULL ,
	AVERAGE_LENGTH_OF_STAY_FOR_HOME_HEALTH varchar(20)  NULL ,
	AVERAGE_LENGTH_OF_STAY_FOR_HOSPICE varchar(20)  NULL ,
	AVERAGE_LENGTH_OF_STAY_FOR_HOSPITAL varchar(20)  NULL ,
	AVERAGE_LENGTH_OF_STAY_FOR_REHAB varchar(20)  NULL ,
	AVERAGE_LENGTH_OF_STAY_FOR_SNF char(18)  NULL ,
	VERAGE_LENGTH_OF_STAY_FOR_SUBSEQUENT_HOSPITALIZATION varchar(20)  NULL ,
	HOSPITAL_COST_REPORT_BEDS_FACT_KEY varchar(20)  NOT NULL 
);


-- ADDING PRIMARY KEY CONSTRAINT TO EPISODE_OF_CARE

ALTER TABLE EPISODE_OF_CARE
	ADD CONSTRAINT PK_EPISODE_OF_CARE_HOSPITAL_EPISODES_OF_CARE_BY_DRG_FACT_KEY PRIMARY KEY  (HOSPITAL_EPISODES_OF_CARE_BY_DRG_FACT_KEY);



CREATE TABLE HEALTH_SYSTEM
( 
	TORCH_HEALTH_SYSTEM_ID varchar(20)  NOT NULL ,
	NAME                 varchar(20)  NULL ,
	ADDRESS_LINE_1       varchar(20)  NULL ,
	ADDRESS_LINE_2       varchar(20)  NULL ,
	CITY                 varchar(20)  NULL ,
	STATE                varchar(20)  NULL ,
	ZIP                  varchar(20)  NULL ,
	PHONE                varchar(20)  NULL ,
	WEBSITE              varchar(20)  NULL 
);

-- ADDING PRIMARY KEY CONSTRAINT TO TABLE

ALTER TABLE HEALTH_SYSTEM
	ADD CONSTRAINT PK_HEALTH_SYSTEM_TORCH_HEALTH_SYSTEM PRIMARY KEY  CLUSTERED (TORCH_HEALTH_SYSTEM_ID);


--CREATING TABLE HOSPITAL_BEDS TABLE

CREATE TABLE HOSPITAL_BEDS
( 
	HOSPITAL_COST_REPORT_BEDS_FACT_KEY varchar(20)  NOT NULL ,
	YEAR_KEY             datetime  NULL ,
	BURN_ICU_BEDS        varchar(20)  NULL ,
	CORONARY_CARE_BEDS   varchar(20)  NULL ,
	HOSPICE_BEDS         varchar(20)  NULL ,
	INTENSIVE_CARE_BEDS  varchar(20)  NULL ,
	NURSING_FACILITY_BEDS varchar(20)  NULL ,
	OTHER_LONG_TERM_CARE_BEDS varchar(20)  NULL ,
	OTHER_SPECIAL_CARE_BEDS varchar(20)  NULL ,
	SKILLED_NURSING_FACILITY_BEDS varchar(20)  NULL ,
	SURGICAL_INTENSIVE_CARE_BEDS varchar(20)  NULL ,
	LABOR_AND_DELIVERY_BEDS varchar(20)  NULL ,
	SUBPROVIDER_IPF_BEDS varchar(20)  NULL ,
	SUBPROVIDER_IRF_BEDS varchar(20)  NULL ,
	SUBPROVIDER_OTHER_BEDS varchar(20)  NULL ,
	HOSPITAL_ADULT_PEDS_BEDS varchar(20)  NULL ,
	INPATIENT_TOTAL_BEDS varchar(20)  NULL 
)


--ADDING PRIMARY KEY CONSTRAINT TO THE TABLE 

ALTER TABLE HOSPITAL_BEDS
	ADD CONSTRAINT PK_HOSPITAL_BEDS PRIMARY KEY  (HOSPITAL_COST_REPORT_BEDS_FACT_KEY);

--CREATING HOSPITAL_DISCHARGES TABLE

CREATE TABLE HOSPITAL_DISCHARGES
( 
	HOSPITAL_COST_REPORT_DISCHARGES_FACT_KEY varchar(20)  NOT NULL ,
	HOSPITAL_DIM_KEY     varchar(20)  NOT NULL ,
	YEAR_KEY             datetime  NULL ,
	TITLE_V_DISCHARGES   varchar(20)  NULL ,
	MEDICARE_DISCHARGES  varchar(2000)  NULL ,
	MEDICAID_DISCHARGES  varchar(20)  NULL ,
	TOTAL_DISCHARGES     varchar(20)  NULL ,
	TITLE_V_HOSPITAL_ADULT_PEDS_DISCHARGES varchar(20)  NULL ,
	MEDICARE_HOSPITAL_ADULT_PEDS_DISCHARGES varchar(20)  NULL ,
	MEDICAID_HOSPITAL_ADULT_PEDS_DISCHARGES varchar(20)  NULL ,
	TOTAL_HOSPITAL_ADULT_PEDS_DISCHARGES varchar(20)  NULL ,
	TITLE_V_SUBPROVIDER_IPF_DISCHARGES varchar(20)  NULL ,
	MEDICARE_SUBPROVIDER_IPF_DISCHARGES varchar(20)  NULL ,
	MEDICAID_SUBPROVIDER_IPF_DISCHARGES varchar(20)  NULL ,
	TOTAL_SUBPROVIDER_IPF_DISCHARGES varchar(20)  NULL ,
	TITLE_V_SUBPROVIDER_IRF_DISCHARGES varchar(20)  NULL ,
	MEDICARE_SUBPROVIDER_IRF_DISCHARGES varchar(20)  NULL ,
	MEDICAID_SUBPROVIDER_IRF_DISCHARGES varchar(20)  NULL ,
	TOTAL_SUBPROVIDER_IRF_DISCHARGES varchar(20)  NULL ,
	TITLE_V_SUBPROVIDER_OTHER_DISCHARGES varchar(20)  NULL ,
	MEDICARE_SUBPROVIDER_OTHER_DISCHARGES varchar(20)  NULL ,
	MEDICAID_SUBPROVIDER_OTHER_DISCHARGES varchar(20)  NULL ,
	TOTAL_SUBPROVIDER_OTHER_DISCHARGES varchar(20)  NULL ,
	MEDICARE_HMO_DISCHARGES varchar(20)  NULL ,
	OTHER_LONG_TERM_CARE_DISCHARGES varchar(20)  NULL ,
	HOSPITAL_COST_REPORT_BEDS_FACT_KEY varchar(20)  NOT NULL 
);


--ADDING PRIMARY KEY CONSTRAINT TO THE TABLE

ALTER TABLE HOSPITAL_DISCHARGES
	ADD CONSTRAINT PK_HOSPITAL_DISCHARGES PRIMARY KEY  (HOSPITAL_COST_REPORT_DISCHARGES_FACT_KEY);


--CREATING HOSPITAL HEALTH SYSTEM AFILIATION TABLE

CREATE TABLE HOSPITAL_HEALTH_SYSTEM_AFILIATION
( 
	HEALTH_SYSTEM_DIM_KEY varchar(20)  NOT NULL ,
	TORCH_HEALTH_SYSTEM_ID varchar(20)  NOT NULL ,
	TORCH_HOSPITAL_ID    varchar(20)  NULL ,
	TYPE                 varchar(20)  NULL ,
	EFFECTIVE_BEGIN      datetime  NULL ,
	EFFECTIVE_END        datetime  NULL ,
	HOSPITAL_DIM_KEY     varchar(20)  NOT NULL ,
	HOSPITAL_COST_REPORT_BEDS_FACT_KEY varchar(20)  NOT NULL 
);

--ADDING PRIMARY KEY CONSTRAINT TO THE TABLE

ALTER TABLE HOSPITAL_HEALTH_SYSTEM_AFILIATION
	ADD CONSTRAINT PK_HOSPITAL_HEALTH_SYSTEM_AFILIATION PRIMARY KEY (HEALTH_SYSTEM_DIM_KEY);

--CREATING HOSPITAL_REVENUE TABLE

CREATE TABLE HOSPITAL_REVENUE
( 
	HOSPITAL_COST_REPORT_TOTAL_REVENUE_FACT_KEY varchar(20)  NOT NULL ,
	YEAR_KEY             datetime  NULL ,
	HOSPITAL_GENERAL_REVENUE varchar(20)  NULL ,
	SUBPROVIDER_IPF_REVENUE varchar(20)  NULL ,
	SUBPROVIDER_IRF_REVENUE varchar(20)  NULL ,
	SUBPROVIDER_OTHER_REVENUE varchar(20)  NULL ,
	SWING_BED_SNF_REVENUE varchar(20)  NULL ,
	SWING_BED_NF_REVENUE varchar(20)  NULL ,
	SKILLED_NURSING_FACILITY varchar(20)  NULL ,
	NURSING_FACILITY_REVENUE varchar(20)  NULL ,
	OTHER_LONG_TERM_CARE_REVENUE varchar(20)  NULL ,
	GENERAL_CARE_SERVICES_REVENUE varchar(20)  NULL ,
	INTENSIVE_CARE_UNIT_REVENUE varchar(20)  NULL ,
	CORONARY_CARE_UNIT_REVENUE varchar(20)  NULL ,
	BURN_INTENSIVE_CARE_UNIT_REVENUE varchar(20)  NULL ,
	SURGICAL_INTENSIVE_CARE_UNIT_REVENUE varchar(20)  NULL ,
	INTENSIVE_CARE_SERVICES_REVENUE varchar(20)  NULL ,
	INPATIENT_ROUTINE_CARE_REVENUE varchar(20)  NULL ,
	ANCILLARY_SERVICES_REVENUE varchar(20)  NULL ,
	OUTPATIENT_SERVICES_REVENUE varchar(20)  NULL ,
	RURAL_HEALTH_CLINIC_REVENUE varchar(20)  NULL ,
	FEDERALLY_QUALIFIED_HEALTH_CENTER_REVENUE varchar(20)  NULL ,
	HOME_HEALTH_AGENCY_REVENUE varchar(20)  NULL ,
	AMBULANCE_REVENUE    varchar(20)  NULL ,
	REHABILITATION_PROVIDERS_REVENUE varchar(20)  NULL ,
	AMBULATORY_SURGICAL_CENTER_REVENUE varchar(20)  NULL ,
	HOSPICE_REVENUE      varchar(20)  NULL ,
	OTHER_REVENUE        varchar(20)  NULL ,
	TOTAL_PATIENT_REVENUE varchar(20)  NULL ,
	CONTRACTUAL_ALLOWANCES_DISCOUNTS varchar(20)  NULL ,
	NET_PATIENT_REVENUE  varchar(20)  NULL ,
	NET_INCOME_FROM_SERVICE_TO_PATIENTS varchar(20)  NULL ,
	HOSPITAL_DIM_KEY     varchar(20)  NOT NULL ,
	HOSPITAL_COST_REPORT_BEDS_FACT_KEY varchar(20)  NOT NULL 
);

--ADDING PRIMARY KEY CONSTRAINT TO THE TABLE

ALTER TABLE HOSPITAL_REVENUE
	ADD CONSTRAINT PK_HOSPITAL_REVENUE PRIMARY KEY (HOSPITAL_COST_REPORT_TOTAL_REVENUE_FACT_KEY);



CREATE TABLE HOSPITAL_VALUE_BASE_PURCHASING_PROGRAM_DATA
( 
	VALUE_BASED_PURCHASING_FACT_KEY varchar(20)  NOT NULL ,
	HOSPITAL_DIM_KEY     varchar(20)  NOT NULL ,
	YEAR_KEY             datetime  NULL ,
	WEIGHTED_CLINICAL_PROCESS_OF_CARE_DOMAIN_SCORE varchar(20)  NULL ,
	WEIGHTED_PATIENT_EXPERIENCE_OF_CARE_DOMAIN_SCORE varchar(20)  NULL ,
	WEIGHTED_EFFICIENCY_DOMAIN_SCORE varchar(20)  NULL ,
	TOTAL_PERFORMANCE_SCORE varchar(20)  NULL ,
	ACTUAL_FY_HOSPITAL_VBP_ADJUSTMENT_FACTOR varchar(20)  NULL ,
	ESTIMATED_VBP_ADJUSTMENT_DOLLAR_VALUE varchar(20)  NULL ,
	HOSPITAL_COST_REPORT_BEDS_FACT_KEY varchar(20)  NOT NULL 
);




ALTER TABLE HOSPITAL_VALUE_BASE_PURCHASING_PROGRAM_DATA
	ADD CONSTRAINT XPKHOSPITAL_VALUE_BASE_PURCHASING_PROGRAM_DATA PRIMARY KEY  CLUSTERED (VALUE_BASED_PURCHASING_FACT_KEY ASC,HOSPITAL_DIM_KEY ASC,HOSPITAL_COST_REPORT_BEDS_FACT_KEY ASC)
go



CREATE TABLE HOSPITALS
( 
	HOSPITAL_DIM_KEY     varchar(20)  NOT NULL ,
	TORCH_HOSPITAL_ID    varchar(20)  NULL ,
	PROVIDER_NUMBER      varchar(2000)  NULL ,
	HOSPITAL_TYPE        varchar(2000)  NULL ,
	ZIP                  integer  NULL ,
	NAME                 varchar(2000)  NOT NULL ,
	ADDRESS_LINE_1       varchar(2000)  NULL ,
	ADDRESS_LINE_2       varchar(200)  NULL ,
	CITY                 char  NULL ,
	STATE                varchar(20)  NULL ,
	COUNTY_NAME          varchar(200)  NULL ,
	HOSPITAL_OWNERSHIP   varchar(200)  NULL ,
	PHONE                varchar(20)  NULL ,
	FORMALY_KNOWN_AS     varchar(200)  NULL ,
	DEACTIVATED_0_1_FLAG integer  NULL ,
	CLOSED_0_1_FLAG      float  NULL ,
	CLOSED_DATE          datetime  NULL ,
	PRIMARY_EHR_PRODUCT_NAME varchar(200)  NULL ,
	SUPPRESSION_0_1_FLAG integer  NULL ,
	HOSPITAL_COST_REPORT_BEDS_FACT_KEY varchar(20)  NOT NULL 
);



ALTER TABLE HOSPITALS
	ADD CONSTRAINT PK_HOSPITALS PRIMARY KEY  (HOSPITAL_DIM_KEY);

